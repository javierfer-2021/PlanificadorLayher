<mat-progress-bar mode="indeterminate" *ngIf="LPGen(WSDatos_Validando)"></mat-progress-bar>

<div class="container" #container (window:resize)="onResize($event)" style="overflow-y: auto; height: 100%;">
    <div #pantalla>

        <!-- Titulo -->
        <div class="row px-1 py-2 titulo">
            <div class="col pt-1 px-1">
                <div class="fs-11 fs-sm-16 fs-md-16 fs-lg-16 fs-xl-16"> 
                    {{traducir('frm-venta-detalles.lblTitulo', 'Detalles contratro Salida Material')}}
                    &nbsp;({{_salida.NombreTipoDocumento}})
                </div>                
            </div>
            <div class="col-2 pt-0 px-1" style="text-align: end;">
                <button type="button" class="btn btn-outline-secondary botonAyuda" (click)="mostrarAyuda()">
                    <i class="bi bi-question-circle"></i>
                </button>                    
            </div>                 
        </div>         

        <!-- Formulario Datos Salida (Venta-Alquiler) -->
        <div class="row pt-2">
            <div id="form-container" class="formulario">
                <dx-form id="formSalida" #formSalida [colCount]="3" [formData]="_salida" labelMode='static' labelLocation="left" [readOnly]="!modoEdicion">
                    <!-- <dxi-item itemType="group" caption="" [colCount]="3" [colSpan]="3"> -->
                        <dxi-item dataField="Contrato" [editorOptions]="{disabled: true}">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo CONTRATO"></dxi-validation-rule>
                        </dxi-item>
                        <dxi-item dataField="IdEstado" 
                            editorType="dxSelectBox" 
                            [editorOptions]="{ disabled:false, dataSource:arrayTiposEstadoSalida, displayExpr:'NombreEstado', valueExpr:'IdEstado', searchEnabled: true }">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo ESTADO"></dxi-validation-rule>
                        </dxi-item>
                        <dxi-item dataField="FechaAlta" [editorOptions]="{disabled: true}">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo FECHA ALTA"></dxi-validation-rule>
                        </dxi-item>

                        <dxi-item dataField="IdClienteERP" [colSpan]="1" [editorOptions]="{disabled: true}">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo ID CLIENTE"></dxi-validation-rule>
                        </dxi-item>                            
                        <dxi-item dataField="NombreCliente" [colSpan]="2" [editorOptions]="{disabled: true}">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo NOMBRE CLIENTE"></dxi-validation-rule>
                        </dxi-item>                            

                        <dxi-item dataField="Referencia" [editorOptions]="{disabled: false}">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo REFERENCIA"></dxi-validation-rule>
                        </dxi-item>
                        <dxi-item dataField="Obra" [editorOptions]="{disabled: false}">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo OBRA"></dxi-validation-rule>
                        </dxi-item>
                        <dxi-item itemType="empty" [colSpan]="1"></dxi-item>

                        <dxi-item dataField="IdAlmacen" 
                            editorType="dxSelectBox" 
                            [editorOptions]="{disabled:true, dataSource:arrayAlmacenes, displayExpr:'NombreAlmacen', valueExpr:'IdAlmacen', searchEnabled: true }">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo ALMACEN"></dxi-validation-rule>
                        </dxi-item>
                        <dxi-item name="fechaInicio" dataField="FechaInicio" 
                            editorType="dxDateBox" 
                            [editorOptions]="{disabled:false, width:'100%',displayFormat:'dd/MM/yyyy', onValueChanged:onFechaInicioValueChanged.bind(this) }">
                            <dxi-validation-rule type="required" message="Debe indicar un valor para el campo FECHA INICIO"></dxi-validation-rule>
                        </dxi-item>
                        <dxi-item name="fechaFin" dataField="FechaFin" 
                            editorType="dxDateBox" 
                            [editorOptions]="{disabled:false, width:'100%',displayFormat:'dd/MM/yyyy', onValueChanged:onFechaFinValueChanged.bind(this)}">
                            <dxi-validation-rule *ngIf="requerirFechaFin" type="required" message="Debe indicar un valor para el campo FECHA FIN"></dxi-validation-rule>
                        </dxi-item>

                        <dxi-item dataField="Planificar" editorType="dxCheckBox" [editorOptions]="{disabled:true, width:'100%'}"></dxi-item>
                        <dxi-item dataField="Observaciones" editorType="dxTextArea" [editorOptions]="{ height: 90 }" [colSpan]="2"></dxi-item>

                        <!-- <dxi-item itemType="empty" [colSpan]="2"></dxi-item> -->
                </dx-form>
            </div>
        </div>
                  
        <!-- grid lineas cargadas del CSVs -->    
        <div class="row pt-1 px-1">
            <div class="col pt-1 px-1">    
                <app-cmp-data-grid #dg [dgConfig]="dgConfigLineas"
                    (onRowPrepared_DataGrid)="onRowPrepared_DataGrid($event)">
                </app-cmp-data-grid>
            </div>
        </div>            

    </div>
</div>

<div #btnFooter>
    <app-cmp-botones-pantallas [botones]="btnAciones"></app-cmp-botones-pantallas>
</div>

<!-- popUp Editar Linea Salida -->
<dx-popup *ngIf="popUpVisibleEditarLinea" #popUpEditarLinea (window:resize)="onResize($event)" [dragEnabled]="false" modal="true" height="335px" width="960px"
    [fullScreen]="false" 
    [(visible)]="popUpVisibleEditarLinea" [showTitle]="true" [showCloseButton]="true" [closeOnOutsideClick]="false" 
    title="{{traducir('frm-venta-detalles.str_txtPopupEditarLinea', 'Editar LÃ­nea Salida')}}"
    contentTemplate="contentEditarLinea">
    <div *dxTemplate="let data of 'contentEditarLinea'">
        <app-frm-venta-lineas [linea]="lineaSeleccionada" (cerrarPopUp)="cerrarEditarLinea($event)"></app-frm-venta-lineas>
    </div>    
</dx-popup>

<!-- popUp Salidas afectadas -->
<dx-popup *ngIf="popUpVisibleSalidasAfectadas" #popUpSalidasAfectadas (window:resize)="onResize($event)" [dragEnabled]="false" modal="true" height="80%" width="80%"
    [fullScreen]="false" 
    [(visible)]="popUpVisibleSalidasAfectadas" [showTitle]="true" [showCloseButton]="true" [closeOnOutsideClick]="false" 
    title="{{traducir('frm-venta-detalles.str_txtPopupSalidasAfectadas', 'Lista salidas afectadas por cambio')}}"
    contentTemplate="contentSalidasAfectadas">
    <div *dxTemplate="let data of 'contentSalidasAfectadas'">
        <app-frm-contratos-afectados [_salida]="_salida" (cerrarPopUp)="cerrarSalidasAfectadas($event)"></app-frm-contratos-afectados>
    </div>    
</dx-popup>

<!-- popUp ayuda pantalla -->
<dx-popup  #popUpAyuda (window:resize)="onResize($event)" [dragEnabled]="false"  modal="true" height="70%" width="70%"
    [fullScreen]="false" 
    [(visible)]="popUpVisibleAyuda" [showTitle]="true" [showCloseButton]="true" [closeOnOutsideClick]="false" 
    title="{{traducir('frm-venta-buscar.str_txtPopupAyuda', 'Ayuda...')}}"
    contentTemplate="contentAyuda">
    <div *dxTemplate="let data of 'contentAyuda'">
        <app-frm-ayuda-pantalla [nombrePantalla]="'frm-venta-detalles'" (cerrarPopUp)="cerrarAyuda($event)"></app-frm-ayuda-pantalla>
    </div>    
</dx-popup>